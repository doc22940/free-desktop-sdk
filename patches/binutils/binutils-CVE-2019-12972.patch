commit 890f750a3b053532a4b839a2dd6243076de12031
Author: Alan Modra <amodra@gmail.com>
Date:   Fri Jun 21 11:51:38 2019 +0930

    PR24689, string table corruption
    
    The testcase in the PR had a e_shstrndx section of type SHT_GROUP.
    hdr->contents were initialized by setup_group rather than being read
    from the file, thus last byte was not zero and string dereference ran
    off the end of the buffer.
    
            PR 24689
            * elfcode.h (elf_object_p): Check type of e_shstrndx section.

index a0487b0843..5180f79a74 100644
--- a/bfd/elfcode.h
+++ b/bfd/elfcode.h
@@ -754,7 +754,8 @@ elf_object_p (bfd *abfd)
   /* A further sanity check.  */
   if (i_ehdrp->e_shnum != 0)
     {
-      if (i_ehdrp->e_shstrndx >= elf_numsections (abfd))
+      if (i_ehdrp->e_shstrndx >= elf_numsections (abfd)
+	  || i_shdrp[i_ehdrp->e_shstrndx].sh_type != SHT_STRTAB)
 	{
 	  /* PR 2257:
 	     We used to just goto got_wrong_format_error here
