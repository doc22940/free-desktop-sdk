kind: manual

depends:
- filename: bootstrap-import.bst

config:
  build-commands:
  - |
    make -f unix/Makefile LOCAL_UNZIP="${CFLAGS} -DNO_LCHMOD" LFLAGS2="${LDFLAGS}" generic_gcc

  install-commands:
  - |
    make -f unix/Makefile BINDIR="%{install-root}%{bindir}" MANDIR="%{install-root}%{datadir}/man/man1" install

  - |
    rm "%{install-root}%{bindir}/zipinfo"
    ln -s unzip "%{install-root}%{bindir}/zipinfo"

public:
  cpe:
    vendor: 'info-zip'
    version: '6.0'
    patches:
      - CVE-2014-9636
      - CVE-2014-9913
      - CVE-2015-7696
      - CVE-2015-7697
      - CVE-2016-9844
      - CVE-2018-18384

sources:
- kind: tar
  url: sourceforge_download:infozip/unzip60.tar.gz
- kind: patch
  path: patches/unzip/CVE-2014-9636.patch
- kind: patch
  path: patches/unzip/CVE-2014-9913.patch
- kind: patch
  path: patches/unzip/CVE-2015-7696.patch
- kind: patch
  path: patches/unzip/CVE-2015-7697.patch
- kind: patch
  path: patches/unzip/CVE-2016-9844.patch
- kind: patch
  path: patches/unzip/CVE-2018-18384.patch
- kind: patch
  path: patches/unzip/unzip-6.0-bzip2-configure.patch
- kind: patch
  path: patches/unzip/unzip-6.0-configure.patch
